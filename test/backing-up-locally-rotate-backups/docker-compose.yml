version: "3"

services:

  dashboard:
    image: grafana/grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana-data:/var/lib/grafana

  backup:
    build: ../..
    environment:
      BACKUP_CRON_EXPRESSION: "0 0 * * *"
      ROTATE_BACKUPS: dry-run                   # You can test your rotation scheme beforehand by peforming a "dry-run".
      ROTATE_HOURLY: 0                          # See container logs for information on the dry-run.
      ROTATE_DAILY: 7                           # If your rotation scheme works as expected, set ROTATE_BACKUPS: true in order to apply your scheme.
      ROTATE_WEEKLY: 4                          # Here, you can see the default values of ROTATE_*.
      ROTATE_MONTHLY: 12                        # You can customize them by means of setting the respective environmentel variables.
      ROTATE_YEARLY: always
    volumes:
      - grafana-data:/backup/grafana-data:ro
      - ./backups:/archive

volumes:
  grafana-data:
